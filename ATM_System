import os
import hashlib
import datetime

#dictionary to temporary store user account details
user_accounts = {}

# Function to display the main menu
def display_main_menu():
    print("Welcome to Islami Bank Bangladesh Limited (IBBL) ATM")
    print("=====================================================")
    print("1. Sign in")
    print("2. Sign up")
    print("3. Quit")
    choice = input("Enter your choice (1-3): ")
    return choice

# Function to sign up
def sign_up():
    os.system('cls')
    print("Sign Up")
    print("-------")
    name = input("Enter your account name: ")
    account_number = input("Enter your account number: ")
    password = input("Enter your password: ")
    password_hash = hashlib.md5(password.encode()).hexdigest()
    user_accounts[account_number] = {"name": name, "balance": 0, "password_hash": password_hash}
    print("Your account has been created successfully.")

# Function to sign in
def sign_in():
    os.system('cls')
    if len(user_accounts) == 0:
        print("\t\t--------No data found--------\n")
        return
    print("Sign In")
    print("-------")
    account_number = input("Enter your account number: ")
    password = input("Enter your password: ")
    password_hash = hashlib.md5(password.encode()).hexdigest()
    if account_number in user_accounts and user_accounts[account_number]["password_hash"] == password_hash:
        display_user_menu(account_number)
    else:
        print("Incorrect account number or password.")

# Function to display the user menu
def display_user_menu(account_number):
    current_datetime = datetime.datetime.now()
    formatted_date = current_datetime.strftime('%d-%m-%Y')
    formatted_time = current_datetime.strftime('%I:%M:%S %p')
    print("\n\t\tCurrent date: " + formatted_date)
    print("\t\tCurrent time: " + formatted_time)
    print()
    print("\tHello " + user_accounts[account_number]["name"] + "!")
    print("What would you like to do?")

    while True:
        print("1. Check balance")
        print("2. Withdraw")
        print("3. Deposit")
        print("4. Log out")
        choice = input("Enter your choice (1-4): ")
        if choice == "1":
            print("\nYour balance is: $" + str(user_accounts[account_number]["balance"]) + "\n")
        elif choice == "2":
            amount = int(input("Enter the amount you want to withdraw: $"))
            if amount > user_accounts[account_number]["balance"]:
                print("Insufficient balance.")
            else:
                user_accounts[account_number]["balance"] -= amount
                print("Withdrawal successful. Your new balance is: $" + str(user_accounts[account_number]["balance"]))
        elif choice == "3":
            amount = int(input("Enter the amount you want to deposit: $"))
            user_accounts[account_number]["balance"] += amount
            print("Deposit successful. Your new balance is: $" + str(user_accounts[account_number]["balance"]))
        elif choice == "4":
            break

# Main program
while True:
    choice = display_main_menu()
    if choice == "1":
        sign_in()
    elif choice == "2":
        sign_up()
    elif choice == "3":
        break
    else:
        print("\n\t\tInvalid choice...Try again(Press 1 / 2 / 3)\n")
